generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // ή "mysql" αν προτιμάς
  url      = env("DATABASE_URL")
}

model User {
  id             String          @id @default(cuid())
  email          String          @unique
  passwordHash   String?         // null αν OAuth only
  name           String?
  avatarUrl      String?
  bio            String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  profile        Profile?
  socialAccounts SocialAccount[]
  tools          Tool[]          @relation("ToolOwner")
  credits        Int             @default(0) // χρήματα/credits balance
  transactions   CreditTransaction[]
  views          ViewCount[]
  referrals      Referral[]      @relation("Referrer")
  referredById   String?         
  referredBy     User?           @relation("Referrer", fields: [referredById], references: [id])
}

model Profile {
  id        String  @id @default(cuid())
  user      User    @relation(fields: [userId], references: [id])
  userId    String  @unique
  handle    String  @unique
  website   String?
  location  String?
  bannerUrl String?
  createdAt DateTime @default(now())
}

model SocialAccount {
  id         String  @id @default(cuid())
  user       User    @relation(fields: [userId], references: [id])
  userId     String
  provider   String  // e.g., "twitter", "youtube", "tiktok"
  providerId String
  url        String?
  createdAt  DateTime @default(now())
}

model Tool {
  id           String   @id @default(cuid())
  owner        User?    @relation("ToolOwner", fields: [ownerId], references: [id])
  ownerId      String?
  slug         String   @unique
  title        String
  description  String?
  icon         String?
  public       Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  metrics      ToolMetrics?
}

model ToolMetrics {
  id         String   @id @default(cuid())
  tool       Tool     @relation(fields: [toolId], references: [id])
  toolId     String   @unique
  views      Int      @default(0)
  clicks     Int      @default(0)
  avgTimeSec Float    @default(0)
  lastSeen   DateTime?
}

model ViewCount {
  id        String   @id @default(cuid())
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?
  tool      Tool?    @relation(fields: [toolId], references: [id])
  toolId    String?
  sessionId String?
  duration  Int      @default(0) // seconds
  createdAt DateTime @default(now())
  ipHash    String?  // privacy-safe
}

model CreditTransaction {
  id         String   @id @default(cuid())
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  amount     Int      // positive (top-up) or negative (consumption)
  type       String   // e.g., "purchase", "consumption", "referral", "payout"
  meta       Json?
  createdAt  DateTime @default(now())
}

model Referral {
  id           String  @id @default(cuid())
  referrer     User    @relation("Referrer", fields: [referrerId], references: [id])
  referrerId   String
  referred     User    @relation(fields: [referredId], references: [id])
  referredId   String  @unique
  bonusGranted Int     @default(0)
  createdAt    DateTime @default(now())
}

model SiteStat {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  updatedAt DateTime @updatedAt
}
